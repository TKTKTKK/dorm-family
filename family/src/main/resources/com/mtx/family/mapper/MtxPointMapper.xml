<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mtx.family.mapper.MtxPointMapper">

    <resultMap id="selectResultMap" type="com.mtx.family.entity.MtxPoint">
    </resultMap>
    <select id="selectMtxPointList" resultMap="selectResultMap">
        select mp.*,wu.name as membername ,wu.contactno as phone
        from tb_mtx_point_record mp
        inner join tb_wp_user wu on mp.userid=wu.uuid
        where TRUE
        <if test="mtxPoint.membername != null and mtxPoint.membername != ''">
            and wu.name like concat("%",#{mtxPoint.membername},"%")
        </if>
        <if test="mtxPoint.phone != null and mtxPoint.phone != ''">
            and wu.contactno like concat("%",#{mtxPoint.phone},"%")
        </if>
        <if test="mtxPoint.type=='Y'.toString()">
            and mp.points > 0
        </if>
        <if test="mtxPoint.type=='N'.toString()">
            and mp.points &lt; 0
        </if>
        order by wu.uuid,date_format(mp.createon,'%Y-%m-%d %H:%i:%s') desc;
    </select>
    <select id="queryPointForList" resultMap="selectResultMap">
        select mp.*
        from tb_mtx_point_record mp
        where TRUE
        and mp.userid =#{mtxPoint.userid}
        order by date_format(mp.createon,'%Y-%m-%d %H:%i:%s') desc;
        ;
    </select>
    <select id="queryCountConsumePoint" resultType="java.lang.Integer">
        select ifnull(sum(ifnull(mp.points,0)),0)
        from tb_mtx_point_record mp
        where TRUE
        and mp.userid =#{userid}
        and mp.points &lt; 0
        ;
    </select>
</mapper>